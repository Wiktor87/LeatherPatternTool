:root{--bg:#1a1a1a;--panel:#252525;--border:#333;--text:#e0e0e0;--dim:#888;--accent:#0A84FF;--orange:#FF9500;--green:#34C759;--red:#FF3B30;--purple:#AF52DE}
*{box-sizing:border-box;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}
html,body{margin:0;padding:0;overflow:hidden;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;height:100%;color:var(--text);font-size:13px}
#c{display:block;cursor:default;touch-action:none}

/* Left Toolbar */
#toolbar{position:fixed;left:0;top:0;bottom:0;width:56px;background:var(--panel);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:8px 0;z-index:100;overflow-y:auto;overflow-x:hidden}
#toolbar::-webkit-scrollbar{width:4px}
#toolbar::-webkit-scrollbar-thumb{background:#444;border-radius:2px}
.tool-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:44px;margin:2px 4px;padding:4px;background:transparent;border:none;border-radius:6px;color:var(--dim);cursor:pointer;font-size:9px;gap:2px;transition:all .15s;flex-shrink:0}
.tool-btn:hover{background:#333;color:var(--text)}
.tool-btn.active{background:var(--accent);color:#fff}
.tool-btn.active.orange{background:var(--orange)}
.tool-btn.active.purple{background:var(--purple)}
.tool-btn .icon{font-size:16px;line-height:1}
.tool-sep{height:1px;background:var(--border);margin:6px 8px;flex-shrink:0}

/* Top Header */
#header{position:fixed;top:0;left:56px;right:0;height:44px;background:var(--panel);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 12px;gap:12px;z-index:100}
#header .title{font-weight:600;font-size:14px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background .15s}
#header .title:hover{background:rgba(255,255,255,.1)}
#header .spacer{flex:1}
.hdr-btn{height:32px;padding:0 14px;border:none;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;transition:all .15s}
.hdr-btn.primary{background:var(--green);color:#fff}
.hdr-btn.secondary{background:#444;color:var(--text)}
.hdr-btn:hover{filter:brightness(1.1)}

/* Layer Toggle */
#layer-toggle{display:flex;background:#333;border-radius:6px;overflow:hidden}
.layer-btn{padding:6px 14px;border:none;font-size:11px;font-weight:600;cursor:pointer;transition:all .15s;background:transparent;color:var(--dim)}
.layer-btn.active{color:#fff}
.layer-btn.sym.active{background:var(--accent)}
.layer-btn.asym.active{background:var(--orange)}

/* Mode Indicator */
#mode-indicator{position:fixed;top:52px;left:50%;transform:translateX(-50%);background:var(--accent);color:#fff;padding:8px 16px;border-radius:20px;font-size:12px;font-weight:600;display:none;align-items:center;gap:8px;z-index:150}
#mode-indicator.active{display:flex}
#mode-indicator.orange{background:var(--orange)}
#mode-indicator.purple{background:var(--purple)}
#mode-indicator .mode-btn{background:rgba(255,255,255,.25);border:none;color:#fff;width:28px;height:28px;border-radius:14px;cursor:pointer;font-size:14px}

/* Properties Bar (bottom) */
#props-bar{position:fixed;bottom:0;left:56px;right:0;background:var(--panel);border-top:1px solid var(--border);padding:12px 16px;display:none;align-items:center;gap:20px;z-index:100;flex-wrap:wrap;max-height:100px;overflow-y:auto}
#props-bar.active{display:flex}
#props-bar .prop-group{display:flex;align-items:center;gap:5px}
#props-bar label{color:var(--dim);font-size:12px;white-space:nowrap}
#props-bar input[type="checkbox"]{width:16px;height:16px;cursor:pointer}
#props-bar input[type="range"]{width:100px;cursor:pointer}
#props-bar input[type="number"]{width:52px;background:#333;border:1px solid #444;color:var(--text);padding:3px 4px;border-radius:4px;font-size:11px}
#props-bar select{background:#333;border:1px solid #444;color:var(--text);padding:3px 6px;border-radius:4px;font-size:11px;cursor:pointer}
#props-bar .sel-title{font-weight:600;color:var(--orange);font-size:11px;min-width:80px}
.delete-btn{background:var(--red);color:#fff;border:none;padding:5px 10px;border-radius:4px;font-size:10px;font-weight:500;cursor:pointer;margin-left:auto}

/* Stats Bar */
#stats{position:fixed;bottom:0;left:56px;right:0;background:rgba(20,20,20,.9);padding:8px 16px;font-size:11px;color:var(--dim);display:flex;gap:24px;z-index:99}
#stats.hidden{display:none}
#stats .stat{display:flex;gap:6px}
#stats .value{color:var(--green);font-weight:600}
#stats .undo-redo{margin-left:auto;display:flex;gap:4px}
#stats .undo-redo button{background:#333;border:1px solid #444;color:var(--dim);width:28px;height:24px;border-radius:4px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center}
#stats .undo-redo button:hover:not(:disabled){background:#444;color:var(--text)}
#stats .undo-redo button:disabled{opacity:.3;cursor:not-allowed}

/* Settings Panel */
#settings-btn{position:fixed;top:52px;right:10px;width:36px;height:36px;background:var(--panel);border:1px solid var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;color:var(--dim);z-index:150}
#settings-btn:hover{background:#333;color:var(--text)}
#settings-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:transparent;z-index:99;display:none}
#settings-overlay.open{display:block}
#settings-panel{position:fixed;top:44px;right:0;bottom:0;width:220px;background:var(--panel);border-left:1px solid var(--border);padding:12px;overflow-y:auto;z-index:100;transform:translateX(100%);transition:transform .3s}
#settings-panel.open{transform:translateX(0)}
#settings-panel .close-btn{position:absolute;top:8px;right:8px;width:28px;height:28px;background:#444;border:none;border-radius:4px;color:var(--text);cursor:pointer;font-size:16px}
#settings-panel .close-btn:hover{background:#555}
.settings-section{margin-bottom:16px}
.settings-section h3{font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px;margin:0 0 8px;padding-bottom:6px;border-bottom:1px solid var(--border)}
.setting-row{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
.setting-row label{font-size:11px}
.setting-row input[type="range"]{width:70px}
.setting-row input[type="number"]{width:48px;background:#333;border:1px solid #444;color:var(--text);padding:2px 4px;border-radius:3px;font-size:10px;text-align:right}
.setting-row input[type="checkbox"]{width:16px;height:16px}
.setting-row input[type="color"]{width:36px;height:22px;border:none;cursor:pointer;border-radius:3px}
.setting-row select{background:#333;border:1px solid #444;color:var(--text);padding:2px 4px;border-radius:3px;font-size:10px}

/* Publish Mode */
body.publish-mode #toolbar,body.publish-mode #header,body.publish-mode #props-bar,body.publish-mode #stats,body.publish-mode #mode-indicator,body.publish-mode #settings-btn,body.publish-mode #settings-panel,body.publish-mode #settings-overlay,body.publish-mode #outliner-btn,body.publish-mode #outliner-panel,body.publish-mode #file-menu{display:none!important}
body.publish-mode{background:#e0e0e0;overflow:auto}
body.publish-mode #c{background:#fff;border:1px solid #ccc}
#publish-bar{position:fixed;top:0;left:0;right:0;background:#333;padding:10px 20px;display:none;align-items:center;gap:15px;z-index:2000;border-bottom:2px solid var(--green)}
body.publish-mode #publish-bar{display:flex}
#publish-bar .title{color:#fff;font-weight:600;font-size:14px}
#publish-bar .info{color:#aaa;font-size:11px;flex:1}
#publish-bar input{background:#444;border:1px solid #555;color:#fff;padding:6px 12px;border-radius:4px;font-size:12px;width:200px}
#publish-bar .pbtn{padding:8px 14px;border:none;border-radius:4px;font-size:12px;font-weight:500;cursor:pointer}
#publish-bar .pbtn.primary{background:var(--green);color:#fff}
#publish-bar .pbtn.secondary{background:#555;color:#fff}
#publish-bar .pbtn.danger{background:var(--red);color:#fff}

@media print{@page{size:A4;margin:0}#publish-bar{display:none!important}body,html{background:#fff!important}body.publish-mode{overflow:visible}#c{margin:0!important;box-shadow:none!important;border:none!important}}
@media(pointer:coarse){.tool-btn{min-height:52px}#props-bar input[type="range"]{width:90px}}

/* Text Editor */
#text-editor{position:fixed;display:none;z-index:300}
#text-editor.active{display:block}
#text-editor input{background:transparent;border:none;outline:none;color:var(--text);font-family:sans-serif;padding:0;margin:0}
#text-editor input:focus{outline:none}

/* Outliner Panel */
#outliner-btn{position:fixed;top:52px;right:50px;width:36px;height:36px;background:var(--panel);border:1px solid var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;color:var(--dim);z-index:150}
#outliner-btn:hover{background:#333;color:var(--text)}
#outliner-panel{position:fixed;top:44px;right:0;bottom:0;width:200px;background:var(--panel);border-left:1px solid var(--border);padding:8px;padding-top:36px;overflow-y:auto;z-index:100;transform:translateX(100%);transition:transform .3s}
#outliner-panel.open{transform:translateX(0)}
#outliner-panel .close-btn{position:absolute;top:8px;right:8px;width:24px;height:24px;background:#444;border:none;border-radius:4px;color:var(--text);cursor:pointer;font-size:14px;z-index:1}
#outliner-panel .panel-title{position:absolute;top:10px;left:8px;font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px}
#outliner-panel h3{font-size:11px;color:var(--dim);margin:12px 0 6px;padding-bottom:4px;border-bottom:1px solid var(--border)}
#outliner-panel h3:first-child{margin-top:4px}
.outliner-item{display:flex;align-items:center;padding:4px 6px;margin:2px 0;border-radius:4px;cursor:pointer;font-size:11px;gap:6px}
.outliner-item:hover{background:#333}
.outliner-item.selected{background:var(--accent);color:#fff}
.outliner-item.hidden-item{opacity:.4}
.outliner-item.hidden-item .name{text-decoration:line-through}
.outliner-item.locked-item .name{color:#f90}
.outliner-item.drag-over{background:#444;border-left:3px solid var(--accent)}
.outliner-item .icon{opacity:.6;font-size:12px}
.outliner-item .name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.outliner-item .vis-toggle{font-size:10px;opacity:.5;padding:2px;cursor:pointer}
.outliner-item .vis-toggle:hover{opacity:1}
.outliner-item .lock-toggle{font-size:10px;opacity:.5;padding:2px;cursor:pointer}
.outliner-item .lock-toggle:hover{opacity:1}

/* Text props in props-bar */
#prop-font select{max-width:90px}
#prop-fontsize input{width:50px}

/* File Menu */
#file-menu{position:fixed;top:44px;right:90px;background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:4px;display:none;flex-direction:column;gap:2px;z-index:200;box-shadow:0 4px 12px rgba(0,0,0,.3)}
#file-menu.open{display:flex}
#file-menu button{background:transparent;border:none;color:var(--text);padding:8px 16px;text-align:left;cursor:pointer;border-radius:4px;font-size:12px;white-space:nowrap}
#file-menu button:hover{background:#333}